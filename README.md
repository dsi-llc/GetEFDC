# GetEFDC

## Introduction
GetEFDC is a Fortran utility developed by Dynamic Solutions International LLC (DSI) to extract the output files generated by EFDCPlus (formerly EFDC_DSI) from binary to ASCII format. GetEFDC is an open source tool and is only intended as a building block, it is not a final model output analysis tool. The user should modify GetEFDC to meet their specific needs.

The common binary files that are generated by EFDCPlus are as follows:

* EE_WS.OUT
* EE_VEL.OUT
* EE_WC.OUT
* EE_WQ.OUT
* EE_DRIFTER.OUT
* EE_BED.OUT
* EE_BC.OUT
* SGZLAYER.OUT (for 083_OMP in case of IGRIDV = 2)

EE_WQ.OUT and EE_DRIFTER.OUT are the optional outputs based on the terms activated in EFDC model, in which EE_WQ.OUT is the output for water quality and EE_DRIFTER.OUT is for LPT simulations. When KB > 1 then EE_BED.OUT is also available.

The source code files of GetEFDC include:

Main program:
* getefdc.f90
  
and 8 Modules:

* infomod.f90,
* efdcpromod.f90,
* tecmod.f90,
* geteeoutmod.f90,
* xyijconv.f90,
* gethfreqout.f90,
* globalvars.f90

For 083_OMP, if IGRIDV > 0 then the output is based on the vertical layer defined in sgxlayer.inp / SGZLAYER.OUT

## Getting Started

### Linux

After you [Prepare your environment](https://www.intel.com/content/www/us/en/develop/documentation/get-started-with-intel-oneapi-hpc-linux/top/before-you-begin.html#before-you-begin_HPCCMAKE).

Execute the following:
```bash
git clone https://github.com/dsi-llc/GetEFDC.git
cd GetEFDC
chmod -x toolkit-setup.sh
```
In order to run GetEFDC in Linux the user needs to implement the following steps:
* Only use the FORTRAN source code F90 in GetEFDC folder
* Replace the character “\” with “/” in getefdc.f90 in order that the program can properly find the output folder of the computed model: OUTFOLDER = TRIM(INPFOLDER)//'#output/'
* Compile and build GetEFDC using Makefile provided with the source code.

<hr>

### Windows
**Step 1:**
* Clone the GetEFDC repository: https://github.com/dsi-llc/GetEFDC.git

**Step 2:** Install the following software in the specified order:

* Install Visual Studio:
[Visual Studio Downloads](https://visualstudio.microsoft.com/downloads/)

* Install the Intel Toolkits:
  
  [Intel OneApi Base Toolkit](https://www.intel.com/content/www/us/en/developer/tools/oneapi/base-toolkit-download.html)

  [Intel OneApi HPC Toolkit](https://www.intel.com/content/www/us/en/developer/tools/oneapi/hpc-toolkit-download.html)

**Step 3:** Open the GetEFDC.sln file with Visual Studio. You should reload your project if it says incompatible, then set the Intel compiler to IFX/IFORT.

**Step 4:** Build with Release mode.

**Step 5:** Copy the GetEFDC.exe file from the built folder (GetEFDC-main\src\x64\Debug\GetEFDC.exe) to the folder containing the following files: (GetEFDC.bat, GetEFDC.inp, and Makefile)

**Step 6:** Open the GetEFDC.inp file.

* Update the path to the efdc.inp file (of the model for which you want to extract results).

* Update the number of points for which results need to be extracted.

* Update the I and J indices for those points.

**Step 7:** Run the GetEFDC.bat file and check the results.

### Output

After running GetEFDC a sub-folder “RESULT” is generated in the folder “#output” of the
working model. The extracted files are ASCII with the following conventions for the file
names:
* First characters group shows the constituent, such as SAL for salinity
* Second character group is TSK_ which is the time series of the layer K, such as TSK_4 is time series for the layer K=4
* The last character group is _DOM for the domain or CEL for the selected cells
* The vertical profiles for the constituents at the selected cells use the group _PROF in the file names, such as SAL_PROF.DAT

### Files

This folder contains the following files:

* GetEFDC.inp: The settings file for the GetEFDC tool.
* GetEFDC.bat: A batch file used to run GetEFDC on Windows.
* Makefile: Used to compile GetEFDC.x for Linux.

## Contribute
The open source availability of this code will make it easier for scientists, researchers, and developers to contribute to the code and build more trust in their models. We welcome all the opportunities to collaborate. If you would like to contribute to the source code development, please clone the repository and submit pull requests as needed. For more active contribution and role, please email admin@ds-intl.biz
